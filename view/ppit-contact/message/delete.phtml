<style>
.ppit-header-caption {
	text-align: right;
	font-weight: bold;
}
</style>

<?php
$title = $this->translate('Delete a message', 'ppit-contact', $currentUser->locale);
echo $this->partial('/partials/menu');
$this->headTitle($title);
?>
<div class="row">
    <div class="col-md-6 col-md-offset-3">

<?php
if ($settings['ppitCoreSettings']['viewMode'] != 'SPA') $returnHref = $this->url('message');
else $returnHref = "#";
?>
    <div class="panel panel-default">
            <div class="panel-heading">
				<strong><?php echo $this->translate($title);?></strong>
            </div>
           	<div class="panel-body">
				<table class="table-condensed">

<?php if ($message == 'OK') : ?>
           			<tr id="return">
						<td colspan="2">
							<a id="message_delete_anchor_return" class="glyphicon glyphicon-circle-arrow-left" href="<?php echo $returnHref ?>"></a>
							<a id="message_delete_anchor_return_2" href="<?php echo $returnHref ?>"><?php echo $this->translate('Return', 'ppit-core', $currentUser->locale) ?></a>
						</td>
					</tr>
<?php endif;?>

<!-- Type -->
					<tr>
						<td class="ppit-header-caption"><?php echo $this->translate('Media', 'ppit-contact', $currentUser->locale)?></td>
						<td><?php echo $modelMessage->type; ?></td>
					</tr>

<!-- From -->
					<tr>
						<td class="ppit-header-caption"><?php echo $this->translate('From', 'ppit-contact', $currentUser->locale)?></td>
						<td><?php echo $modelMessage->from; ?></td>
					</tr>

<!-- To -->
					<tr>
						<td class="ppit-header-caption"><?php echo $this->translate('To', 'ppit-contact', $currentUser->locale)?></td>
						<td><?php echo implode(', ', $modelMessage->to); ?></td>
					</tr>

<!-- Subject -->
					<tr>
						<td class="ppit-header-caption"><?php echo $this->translate('Subject', 'ppit-contact', $currentUser->locale)?></td>
						<td><?php echo $modelMessage->subject; ?></td>
					</tr>

				</table>

<!-- Form provided for MPA view mode -->
<?php if ($settings['ppitCoreSettings']['viewMode'] != 'SPA') : ?>
				<form action="<?php echo $this->url('message/delete', array('id' => $this->id)); ?>" method="post">
<?php endif;?>

<?php if ($message == 'OK') : ?>
<!-- Global message -->
					<div class="form-group" id="message">
						<div class="col-sm-12"><h3><?php echo $this->translate('Your request have been registered', 'ppit-core', $currentUser->locale) ?></h3></div>
					</div>
<?php endif;?>
				
<!-- Hidden database update time provided for isolation check -->
					<input type="hidden" name="db_update_time" id="db_update_time" value="<?php echo $modelMessage->update_time ?>"? />
<?php if ($error == 'Isolation') : ?>
					<div class="form-group">
						<div class="col-sm-12"><h4 class="help-block"><?php echo $this->translate('The database has evolved in the meantime, please input again', 'ppit-core', $currentUser->locale) ?></h4></div>
					</div>
<?php endif;?>

<!--  CSRF -->
<?php $element = $csrfForm->get('csrf') ?>
				    <div class="form-group">
						<?php echo $this->formElement($element) ?>
<?php if ($this->formElementErrors($element)) : ?>
						<div class="col-sm-12"><p class="help-block"><?php echo $this->translate('The form has expired, please input again', 'ppit-core', $currentUser->locale) ?></p></div>
<?php endif;?>
					</div>

<?php if ($message == 'OK') : ?>

<!-- Foot return link -->
					<div class="form-group">
						<div class="col-sm-5">&nbsp;</div>
						<div class="col-sm-7">
							<a id='message_delete_anchor_foot_return' href="<?php echo $returnHref ?>"><?php echo $this->translate('Return', 'ppit-core', $currentUser->locale) ?></a>
						</div>
					</div>

<?php else : ?>

<!-- Submit button -->
				    <div class="form-group">
						<div class="col-sm-5">&nbsp;</div>
						<div class="col-sm-7">
							<input name="submit" type="submit" id="message_delete_button" class="btn btn-primary" value="<?php echo $this->translate('Delete', 'ppit-core', $currentUser->locale) ?>" />
							&nbsp;&nbsp;
							<a id="message_delete_cancel" href="<?php echo $returnHref ?>"><?php echo $this->translate('Cancel', 'ppit-core', $currentUser->locale) ?></a>
						</div>
					</div>
<?php endif;?>

<?php if ($settings['ppitCoreSettings']['viewMode'] != 'SPA') : ?>
				</form>
<?php endif;?>
			</div>
		</div>
	</div>
</div>

<?php if ($settings['ppitCoreSettings']['viewMode'] != 'SPA') echo $this->partial('partials/view-controller') ?>

<script id='message_delete_script'>
//Menu
$("#message_delete_anchor_return").click(function () { hideForm(); } );
$("#message_delete_anchor_return_2").click(function () { hideForm(); } );

<?php if ($message == 'OK') : ?>

	//Foot return
	$("#message_delete_anchor_foot_return").click(function () { hideForm(); } );

<?php else : ?>

	//Button
	$("#message_delete_button").click(function () { messageDeleteForm(); } );
	$("#message_delete_cancel").click(function () { hideForm(); } );

<?php endif;?>

//The elements are checked last to first so the focus is positionned on the first element on error
function messageDeleteForm() 
{
	
	// Form provided for MPA view mode
<?php if ($settings['ppitCoreSettings']['viewMode'] != 'SPA') : ?>
	return true;
<?php else : ?>
	var data = new FormData();
	data.append('db_update_time', document.getElementById("db_update_time").value);
	postForm("<?php echo $this->url('message/delete', array('id' => $id)) ?>", 'message_delete_script', data);
	reload("<?php echo $this->url('message') ?>", 'message_script');
<?php endif;?>
}

</script>
